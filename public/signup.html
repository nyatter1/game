<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chat | Sign Up or Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            background-image: radial-gradient(circle at 50% 0%, #1e293b, #0f172a);
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .tab-active {
            border-bottom: 3px solid #eab308;
            color: white;
        }
        input:focus, select:focus {
            box-shadow: 0 0 0 2px rgba(234, 179, 8, 0.3);
            outline: none;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 text-slate-200">
    <div class="max-w-md w-full">
        <div class="text-center mb-6">
            <img src="https://usagif.com/wp-content/uploads/gifs/banana-91.gif" alt="Logo" class="w-16 h-16 mx-auto mb-2 object-contain">
            <h1 class="text-2xl font-black text-white uppercase tracking-wider">Simple Chat</h1>
        </div>

        <div class="glass-card rounded-2xl shadow-2xl overflow-hidden">
            <div class="flex border-b border-slate-700/50">
                <button id="signupTab" class="flex-1 py-4 text-sm font-bold uppercase tracking-widest text-slate-400 transition-all tab-active">Sign Up</button>
                <button id="loginTab" class="flex-1 py-4 text-sm font-bold uppercase tracking-widest text-slate-400 transition-all">Log In</button>
            </div>

            <div class="p-8">
                <!-- Signup Form -->
                <form id="signupForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Age</label>
                            <input type="number" id="regAge" min="13" max="1000" placeholder="13-1000" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Gender</label>
                            <select id="regGender" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-3 text-sm text-white appearance-none cursor-pointer">
                                <option value="" disabled selected>Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="furry">Furry</option>
                                <option value="alien">Alien</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Username</label>
                        <input type="text" id="regUsername" placeholder="Don't use your real name" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white">
                        <p class="text-[10px] text-slate-500 mt-1 italic">3-20 characters, alphanumeric only</p>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Email</label>
                        <input type="email" id="regEmail" placeholder="you@example.com" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white">
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Password</label>
                        <input type="password" id="regPassword" placeholder="Strong password required" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white">
                    </div>

                    <div class="pt-2">
                        <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-black py-4 rounded-lg transition-all shadow-lg text-sm uppercase tracking-widest">
                            Sign Up
                        </button>
                    </div>
                </form>

                <!-- Login Form -->
                <form id="loginForm" class="space-y-4 hidden">
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Username or Email</label>
                        <input type="text" id="loginIdentifier" placeholder="Username" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white">
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2">Password</label>
                        <input type="password" id="loginPassword" placeholder="Password" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white">
                    </div>

                    <div class="pt-2">
                        <button type="submit" class="w-full bg-white hover:bg-slate-100 text-slate-900 font-black py-4 rounded-lg transition-all shadow-lg text-sm uppercase tracking-widest">
                            Log In
                        </button>
                    </div>
                </form>

                <p class="text-[10px] text-center text-slate-500 mt-6 leading-relaxed">
                    By clicking Sign Up, you are agreeing to the Terms of Use including the arbitration clause and you are acknowledging the Privacy Policy.
                </p>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-full text-xs font-bold shadow-2xl opacity-0 transition-opacity pointer-events-none z-50">
        An error occurred.
    </div>

    <script>
        const signupTab = document.getElementById('signupTab');
        const loginTab = document.getElementById('loginTab');
        const signupForm = document.getElementById('signupForm');
        const loginForm = document.getElementById('loginForm');
        const toast = document.getElementById('toast');

        // Helper to get users from "database"
        const getStoredUsers = () => JSON.parse(localStorage.getItem('chat_accounts') || '[]');
        const saveUser = (userObj) => {
            const users = getStoredUsers();
            users.push(userObj);
            localStorage.setItem('chat_accounts', JSON.stringify(users));
        };

        // UI Toggling
        signupTab.addEventListener('click', () => {
            signupTab.classList.add('tab-active');
            loginTab.classList.remove('tab-active');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });

        loginTab.addEventListener('click', () => {
            loginTab.classList.add('tab-active');
            signupTab.classList.remove('tab-active');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
        });

        function showToast(message, type = 'error') {
            toast.textContent = message;
            toast.style.backgroundColor = type === 'error' ? '#ef4444' : '#10b981';
            toast.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => {
                toast.classList.replace('opacity-100', 'opacity-0');
            }, 3000);
        }

        // Handle Signup
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const age = parseInt(document.getElementById('regAge').value);
            const gender = document.getElementById('regGender').value;
            const user = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPassword').value;

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const userRegex = /^[a-zA-Z0-9_]{3,20}$/;

            if (isNaN(age) || age < 13 || age > 1000) {
                return showToast('Age must be between 13 and 1000.');
            }
            if (!gender) {
                return showToast('Please select a gender.');
            }
            if (!userRegex.test(user)) {
                return showToast('Username: 3-20 chars, no special symbols.');
            }
            if (!emailRegex.test(email)) {
                return showToast('Please enter a valid email address.');
            }
            if (pass.length < 8) {
                return showToast('Password must be at least 8 characters.');
            }

            const users = getStoredUsers();
            if (users.find(u => u.username.toLowerCase() === user.toLowerCase())) {
                return showToast('Username already exists.');
            }
            if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
                return showToast('Email already in use.');
            }

            // Create account
            saveUser({ username: user, email: email, password: pass, age, gender });
            
            showToast('Account created! Logging in...', 'success');
            
            // Auto-login logic:
            setTimeout(() => {
                sessionStorage.setItem('chat_username', user);
                sessionStorage.setItem('chat_age', age);
                sessionStorage.setItem('chat_gender', gender);
                window.location.href = '/index.html';
            }, 1000);
        });

        // Handle Login
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const identifier = document.getElementById('loginIdentifier').value.trim();
            const pass = document.getElementById('loginPassword').value;
            
            const users = getStoredUsers();
            const foundUser = users.find(u => 
                (u.username.toLowerCase() === identifier.toLowerCase() || u.email.toLowerCase() === identifier.toLowerCase()) && 
                u.password === pass
            );

            if (foundUser) {
                sessionStorage.setItem('chat_username', foundUser.username);
                sessionStorage.setItem('chat_age', foundUser.age);
                sessionStorage.setItem('chat_gender', foundUser.gender);
                window.location.href = '/index.html';
            } else {
                showToast('Invalid username or password.');
            }
        });

        window.onload = () => {
            if (sessionStorage.getItem('chat_username')) {
                window.location.href = '/index.html';
            }
        };
    </script>
</body>
</html>
