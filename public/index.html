<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Access | Entry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #0f172a;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            height: 100vh;
            overflow: hidden;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-field {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: #fbbf24;
            box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2);
            outline: none;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="glass-card w-full max-w-[400px] rounded-[2.5rem] p-8 shadow-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-amber-400 rounded-2xl mb-4 shadow-lg shadow-amber-400/20">
                <span class="text-3xl">✨</span>
            </div>
            <h1 id="form-title" class="text-2xl font-black text-white tracking-tight">VIP ENTRANCE</h1>
            <p id="form-sub" class="text-slate-400 text-sm mt-1">Please sign in to join the club.</p>
        </div>

        <!-- Notification Box -->
        <div id="msg-box" class="hidden mb-6 p-4 rounded-2xl text-xs font-bold uppercase tracking-widest text-center"></div>

        <!-- Form -->
        <form id="auth-form" class="space-y-4">
            <div id="email-group" class="hidden">
                <label class="block text-[10px] font-bold text-slate-500 uppercase ml-4 mb-1">Email Address</label>
                <input type="email" id="email" class="input-field w-full px-5 py-4 rounded-2xl text-white placeholder-slate-600" placeholder="your@email.com">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase ml-4 mb-1">Username</label>
                <input type="text" id="username" required class="input-field w-full px-5 py-4 rounded-2xl text-white placeholder-slate-600" placeholder="Display Name">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase ml-4 mb-1">Password</label>
                <input type="password" id="password" required class="input-field w-full px-5 py-4 rounded-2xl text-white placeholder-slate-600" placeholder="••••••••">
            </div>

            <button type="submit" id="submit-btn" class="w-full bg-amber-400 hover:bg-amber-300 text-amber-950 font-black py-4 rounded-2xl transition-all active:scale-[0.98] shadow-lg shadow-amber-400/10">
                ENTER LOUNGE
            </button>
        </form>

        <!-- Toggle -->
        <div class="mt-8 text-center">
            <button id="toggle-auth" class="text-xs font-bold text-slate-400 hover:text-white uppercase tracking-widest transition-colors">
                New here? Request Access
            </button>
        </div>
    </div>

    <script>
        const authForm = document.getElementById('auth-form');
        const formTitle = document.getElementById('form-title');
        const formSub = document.getElementById('form-sub');
        const submitBtn = document.getElementById('submit-btn');
        const toggleBtn = document.getElementById('toggle-auth');
        const msgBox = document.getElementById('msg-box');
        const emailGroup = document.getElementById('email-group');

        let isLogin = true;

        // Load Registered Users from LocalStorage
        const getUsers = () => JSON.parse(localStorage.getItem('registered_users') || '{}');

        function showMsg(text, type = 'error') {
            msgBox.innerText = text;
            msgBox.className = `mb-6 p-4 rounded-2xl text-xs font-bold uppercase tracking-widest text-center ${
                type === 'error' ? 'bg-rose-500/10 text-rose-500 border border-rose-500/20' : 'bg-emerald-500/10 text-emerald-500 border border-emerald-500/20'
            }`;
            msgBox.classList.remove('hidden');
        }

        toggleBtn.addEventListener('click', () => {
            isLogin = !isLogin;
            msgBox.classList.add('hidden');
            formTitle.innerText = isLogin ? 'VIP ENTRANCE' : 'MEMBER REGISTRY';
            formSub.innerText = isLogin ? 'Please sign in to join the club.' : 'Create your VIP account below.';
            submitBtn.innerText = isLogin ? 'ENTER LOUNGE' : 'JOIN CLUB';
            toggleBtn.innerText = isLogin ? 'New here? Request Access' : 'Already registered? Sign In';
            emailGroup.classList.toggle('hidden', isLogin);
            
            const emailInput = document.getElementById('email');
            if (isLogin) {
                emailInput.removeAttribute('required');
            } else {
                emailInput.setAttribute('required', '');
            }
        });

        authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const users = getUsers();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value.trim().toLowerCase();

            if (isLogin) {
                // LOGIN LOGIC
                const user = users[username];
                if (!user) {
                    return showMsg('Access Denied: User not found.');
                }
                if (user.password !== password) {
                    return showMsg('Access Denied: Invalid credentials.');
                }

                // Success
                localStorage.setItem('current_user_session', JSON.stringify(user));
                showMsg('Welcome Back, VIP', 'success');
                setTimeout(() => window.location.href = 'chat.html', 800);

            } else {
                // SIGNUP LOGIC
                // Check if username taken
                if (users[username]) {
                    return showMsg('Error: Username already claimed.');
                }

                // Check if email taken
                const emailExists = Object.values(users).some(u => u.email === email);
                if (emailExists) {
                    return showMsg('Error: Email already registered.');
                }

                // Create User
                const newUser = {
                    username: username,
                    password: password,
                    email: email,
                    rank: 'VIP',
                    pfp: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`,
                    joined: new Date().toISOString()
                };

                users[username] = newUser;
                localStorage.setItem('registered_users', JSON.stringify(users));
                localStorage.setItem('current_user_session', JSON.stringify(newUser));

                showMsg('Account Secured! Entering...', 'success');
                setTimeout(() => window.location.href = 'chat.html', 1200);
            }
        });

        // Auto-redirect if already logged in
        if (localStorage.getItem('current_user_session')) {
            window.location.href = 'chat.html';
        }
    </script>
</body>
</html>
