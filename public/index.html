<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatlaxy Pro</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #auth-container, #chat-container { background: #1e1e1e; padding: 20px; border-radius: 8px; width: 350px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .hidden { display: none; }
        input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; background: #333; border: 1px solid #444; color: white; }
        button { width: 100%; padding: 10px; background: #007bff; border: none; color: white; cursor: pointer; border-radius: 4px; }
        button:hover { background: #0056b3; }
        #chat-box { height: 300px; overflow-y: auto; border: 1px solid #444; padding: 10px; margin-bottom: 10px; display: flex; flex-direction: column; }
        .msg { margin-bottom: 8px; font-size: 0.9em; }
        .msg b { color: #007bff; }
        #online-count { font-size: 0.8em; color: #888; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="auth-container">
        <h2>Chatlaxy Pro</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button onclick="signUp()">Sign Up</button>
        <p style="text-align:center; font-size: 0.8em;">OR</p>
        <button onclick="login()" style="background: #28a745;">Login</button>
    </div>

    <div id="chat-container" class="hidden">
        <div id="online-count">Players Online: <span id="count">0</span></div>
        <div id="chat-box"></div>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="message" placeholder="Type a message...">
            <button onclick="sendMessage()" style="width: 70px;">Send</button>
        </div>
        <button onclick="logout()" style="margin-top: 10px; background: #dc3545;">Logout</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDncManQICLPVT8WuMVO5kB-Am32VI12wo",
            authDomain: "chatlaxy-pro.firebaseapp.com",
            projectId: "chatlaxy-pro",
            storageBucket: "chatlaxy-pro.firebasestorage.app",
            messagingSenderId: "807800533954",
            appId: "1:807800533954:web:4165776ac52b93e9cb9c5b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- AUTH LOGIC ---
        window.signUp = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            createUserWithEmailAndPassword(auth, e, p).catch(err => alert(err.message));
        };

        window.login = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, e, p).catch(err => alert(err.message));
        };

        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, user => {
            if (user) {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('chat-container').classList.remove('hidden');
                loadMessages();
            } else {
                document.getElementById('auth-container').classList.remove('hidden');
                document.getElementById('chat-container').classList.add('hidden');
            }
        });

        // --- CHAT LOGIC ---
        window.sendMessage = async () => {
            const msgInput = document.getElementById('message');
            if (msgInput.value.trim() !== "") {
                await addDoc(collection(db, "messages"), {
                    text: msgInput.value,
                    user: auth.currentUser.email,
                    timestamp: serverTimestamp()
                });
                msgInput.value = "";
            }
        };

        function loadMessages() {
            const q = query(collection(db, "messages"), orderBy("timestamp", "asc"));
            onSnapshot(q, (snapshot) => {
                const chatBox = document.getElementById('chat-box');
                chatBox.innerHTML = "";
                snapshot.forEach(doc => {
                    const data = doc.data();
                    chatBox.innerHTML += `<div class="msg"><b>${data.user.split('@')[0]}:</b> ${data.text}</div>`;
                });
                chatBox.scrollTop = chatBox.scrollHeight;
                document.getElementById('count').innerText = snapshot.size; // Simple "Players Online" simulation
            });
        }
    </script>
</body>
</html>
